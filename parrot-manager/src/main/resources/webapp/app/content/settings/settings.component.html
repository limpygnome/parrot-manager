<h1>
    <span class="icon icon-cog"></span>
    Settings
</h1>

<form [formGroup]="settingsForm" (ngSubmit)="save($event)" #form="ngForm">

    <ul class="nav nav-tabs">
        <li (click)="currentTab = 'global'" [ngClass]="{ 'active' : currentTab == 'global' }">
            <a>
                Global
            </a>
        </li>
        <li (click)="currentTab = 'database'" *ngIf="databaseService.isOpen()" [ngClass]="{ 'active' : currentTab == 'database' }">
            <a>
                Current Database
            </a>
        </li>
    </ul>

    <div *ngIf="currentTab == 'global'">
        <div class="row">
            <div class="col-md-4">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Recent files
                        </div>
                    </div>
                    <div class="panel-body">

                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="recentFilesEnabled"
                                       formControlName="recentFilesEnabled"
                                       [(ngModel)]="settingsForm.value['recentFilesEnabled']"
                                />
                                Enabled
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="recentFilesOpenLastOnStartup"
                                       formControlName="recentFilesOpenLastOnStartup"
                                       [(ngModel)]="settingsForm.value['recentFilesOpenLastOnStartup']"
                                />
                                Open last file on startup
                            </label>
                        </div>

                        <div class="form-group" *ngIf="recentFilesClearEnabled">
                            <a class="btn btn-default" (click)="globalRecentFilesClear()">
                                <span class="icon icon-bin"></span>
                                Clear recent files
                            </a>
                        </div>

                    </div>
                </div>

            </div>
            <div class="col-md-4">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Backups
                        </div>
                    </div>
                    <div class="panel-body">

                        <div class="form-group">
                            <label class="form-control-label" for="automaticBackupsRetained">
                                Maximum backups retained
                            </label>
                            <input id="automaticBackupsRetained"
                                   type="number"
                                   class="form-control"
                                   placeholder="Leave empty for unlimited"
                                   formControlName="automaticBackupsRetained"
                                   [(ngModel)]="settingsForm.value['automaticBackupsRetained']"
                            />
                        </div>
                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="automaticBackupsOnSave"
                                       formControlName="automaticBackupsOnSave"
                                       [(ngModel)]="settingsForm.value['automaticBackupsOnSave']"
                                />
                                Backup on save
                            </label>
                        </div>

                    </div>
                </div>

            </div>
            <div class="col-md-4">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Security
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="form-control-label" for="inactivityTimeout">
                                Minutes of inactivity to trigger database close
                            </label>
                            <input id="inactivityTimeout"
                                   type="number"
                                   class="form-control"
                                   placeholder="Number of minutes"
                                   formControlName="inactivityTimeout"
                                   [(ngModel)]="settingsForm.value['inactivityTimeout']"
                            />
                            <small class="form-text text-muted">
                                Leave as zero to disable.
                            </small>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="col-md-4">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Remote Sync
                        </div>
                    </div>
                    <div class="panel-body">

                        <div class="form-group">
                            <label class="form-control-label" for="remoteSyncInterval">
                                Sync interval in minutes
                            </label>
                            <input id="remoteSyncInterval"
                                   type="number"
                                   class="form-control"
                                   placeholder="Number of minutes"
                                   formControlName="remoteSyncInterval"
                                   [(ngModel)]="settingsForm.value['remoteSyncInterval']"
                            />
                            <small class="form-text text-muted">
                                Leave as zero to disable.
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="remoteSyncIntervalEnabled"
                                       formControlName="remoteSyncIntervalEnabled"
                                       [(ngModel)]="settingsForm.value['remoteSyncIntervalEnabled']"
                                />
                                Sync at interval
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="remoteSyncOnOpeningDatabase"
                                       formControlName="remoteSyncOnOpeningDatabase"
                                       [(ngModel)]="settingsForm.value['remoteSyncOnOpeningDatabase']"
                                />
                                Sync on opening database
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox"
                                       id="remoteSyncOnChange"
                                       formControlName="remoteSyncOnChange"
                                       [(ngModel)]="settingsForm.value['remoteSyncOnChange']"
                                />
                                Sync on change
                            </label>
                        </div>

                    </div>
                </div>

            </div>
            <div class="col-md-4">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Customisation
                        </div>
                    </div>
                    <div class="panel-body">

                        <div class="form-group">
                            <label class="form-control-label" for="remoteSyncInterval">
                                Theme
                            </label>
                            <select id="theme" class="form-control"
                                    (change)="themeService.set($event.target.value)"
                                    formControlName="theme"  [(ngModel)]="settingsForm.value['theme']">

                                <option value="">light</option>
                                <option>dark</option>
                                <option>hacker</option>
                            </select>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <div *ngIf="currentTab == 'database' && databaseService.isOpen()">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Database Optimization
                        </div>
                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-xs-4">
                                <a class="btn btn-default" (click)="databaseOptimizeDeletedNodeHistory()">
                                    <span class="icon icon-bin"></span>
                                    Clear deleted node history
                                </a>
                            </div>
                            <div class="col-xs-8">
                                <p>
                                    The identifiers of deleted nodes are retained for remote synchronisation of the database. If you have
                                    synchronised your database with all remote copies, you can wipe the history to reduce storage and memory
                                    usage.
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-4">
                                <a class="btn btn-default" (click)="databaseOptimizeValueHistory()">
                                    <span class="icon icon-bin"></span>
                                    Clear history
                                </a>
                            </div>
                            <div class="col-xs-8">
                                <p>
                                    The history of values is retained, which can be wiped to reduce storage and memory.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">

                <div class="panel panel-default" *ngIf="databaseService.isOpen()">
                    <div class="panel-heading">
                        <div class="panel-title">
                            Change Database Password
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="form-control-label" for="newPassword">
                                Enter password:
                            </label>
                            <input id="newPassword"
                                   type="password"
                                   class="form-control"
                                   placeholder="Leave empty to not change"
                                   formControlName="newPassword"
                                   [(ngModel)]="settingsForm.value['newPassword']"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-control-label" for="newPasswordConfirm">
                                Confirm password:
                            </label>
                            <input id="newPasswordConfirm"
                                   type="password"
                                   class="form-control"
                                   placeholder="Type again to confirm"
                                   formControlName="newPasswordConfirm"
                                   [(ngModel)]="settingsForm.value['newPasswordConfirm']"
                            />
                        </div>
                        <p>
                            After changing your password, you will need to perform an Auth Sync with any remote hosts, specifying
                            your old password.
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div>

        <div class="form-group text-center">
            <button type="button" class="btn btn-primary btn-lg" (click)="save()">
                <span class="icon icon-checkmark"></span>
                Save
            </button>
        </div>

        <div class="form-group text-center">
            <button type="button" class="btn btn-default" (click)="globalResetToDefault()">
                <span class="icon icon-undo2"></span>
                Reset to default
            </button>
        </div>

    </div>

</form>
