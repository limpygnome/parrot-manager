<div class="viewer">

    <div class="sidebar" id="sidebar">
    </div>

    <div class="editor">

        <!-- Home/unselected node page -->
        <div class="home" *ngIf="currentNode == null">
            <h1>
                {{ databaseService.getFileName() }}
            </h1>
            <p>
                Select a node to begin editing.
            </p>
        </div>

        <!-- Page to edit a node -->
        <div class="view" *ngIf="currentNode != null">

            <form [formGroup]="updateEntryForm" #form="ngForm">
                <div class="header">
                    <div class="button">
                        <button class="btn btn-default" *ngIf="!this.currentNode.isRoot()" (click)="changeNodeBeingViewed(currentNode.getParent().getId())">
                            <span class="icon icon-arrow-up2"></span>
                        </button>
                    </div>
                    <div class="title">
                        <input type="text" class="title-input"
                               (change)="updateName($event)"
                               (click)="preUpdateName($event)"
                               (blur)="postUpdateName($event)"
                               value="{{ currentNode.getName() != null ? currentNode.getName() : '(unnamed)' }}"
                        />
                    </div>
                </div>

                <p title="currentNode.getFormattedLastModified()">
                    Last modified: {{ currentNode.getFormattedLastModified() }}
                </p>

                <!-- Value Options -->
                <div class="form-group">
                    <button class="btn btn-primary" (click)="saveValue()">
                        Save Value
                    </button>
                    <button class="btn btn-danger" *ngIf="!currentNode.isRoot()" (click)="deleteEntry(currentNode.getId())">
                        Delete
                    </button>
                    <button class="btn btn-default" (click)="hideValue()">
                        Hide Value
                    </button>
                    <button class="btn btn-default" (click)="copyValueToClipboard()">
                        Copy to Clipboard
                    </button>
                    <button class="btn btn-default">
                        Generate Random
                    </button>
                    <button class="btn btn-default">
                        History
                    </button>
                </div>

                <!-- Generate Random Value Options   -->
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="checkbox-inline">
                                <input type="checkbox" checked /> Numbers
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" checked /> Upper-case
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" checked /> Lower-case
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" checked /> Special Characters
                            </label>
                            <div class="form-inline">
                                <div class="form-group">
                                    <label for="randomMinLength">
                                        Min. Length
                                    </label>
                                    <input type="number" id="randomMinLength" class="form-control" value="8" />
                                </div>
                                <div class="form-group">
                                    <label for="randomMaxLength">
                                        Max. Length
                                    </label>
                                    <input type="number" id="randomMaxLength" class="form-control" value="12" />
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary">
                                        Generate
                                    </button>
                                    <button class="btn btn-default">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current value -->
                <div class="form-group">
                    <textarea id="currentValue"
                              class="form-control"
                              rows="1"
                              placeholder="Click to reveal value"
                              formControlName="currentValue"
                              (click)="preUpdateValue($event)"
                              (keydown)="updateValue($event)"
                    >********</textarea>
                </div>

            </form>

            <!-- List entries -->
            <h2>
                Entries
            </h2>

            <div class="form-group">
                <button class="btn btn-default" (click)="addNewEntry()">
                    Add New Entry
                </button>
                <button class="btn btn-danger" (click)="deleteSelected()">
                    Delete Selected
                </button>
            </div>

            <table class="table entries" id="currentValueEntries">
                <tr>
                    <th>
                        <input type="checkbox" *ngIf="currentNode.getChildCount() != 0" (change)="deleteSelectAll($event)" />
                    </th>
                    <th>
                        Name
                    </th>
                    <th>
                        Value
                    </th>
                    <th>
                        Options
                    </th>
                </tr>

                <tr *ngIf="currentNode.getChildCount() == 0">
                    <td colspan="4">
                        None
                    </td>
                </tr>

                <tr *ngFor="let node of currentNode.getChildren(); trackBy: trackChildren">
                    <td>
                        <input type="checkbox" attr.data-node-id="{{ node.getId() }}" />
                    </td>
                    <td>
                        {{ node.getName() != null ? node.getName() : "(unnamed)" }}
                    </td>
                    <td>
                        <button class="btn btn-default" (click)="toggleMask('#' + node.getId() + '-value', node, false)">
                            Toggle Masking
                        </button>
                        <span id="{{ node.getId() }}-value">
                            ********
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary" (click)="changeNodeBeingViewed(node.getId())">
                            View
                        </button>
                        <button class="btn btn-danger" (click)="deleteEntry(node.getId())">
                            Delete
                        </button>
                        <button class="btn btn-default" (click)="copyValueToClipboard(node.getId())">
                            Copy to Clipboard
                        </button>
                    </td>
                </tr>

            </table>

        </div>

    </div>

</div>
